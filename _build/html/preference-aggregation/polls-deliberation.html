
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Polls and Deliberation &#8212; Computer Simulations for PPE</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Grading Jury Theorem" href="grading-jury-theorem.html" />
    <link rel="prev" title="Probability Models" href="probmodels.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Computer Simulations for PPE</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Course Overview
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Python Basics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../python-basics/overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python-basics/introduction.html">
   Introduction to Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python-basics/classes.html">
   Classes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python-basics/scientific-computing.html">
   Scientific Computing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python-basics/networks.html">
   Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../python-basics/mesa.html">
   Mesa
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Schelling Segregation Model
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../schelling/01-schelling.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../schelling/01a-schelling-implementation.html">
   Implementation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Game Theory
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../game-theory/02a-intro-game-theory.html">
   Introduciton
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../game-theory/02b-games-local-interaction.html">
   Games on a Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../game-theory/02c-divide-the-dollar.html">
   Justice and Bargaining
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Belief Dynamics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../belief-dynamics/overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../belief-dynamics/hk-model.html">
   Hegslemann Krause Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../belief-dynamics/cjt.html">
   Condorcet Jury Theorem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../belief-dynamics/testimony.html">
   Learning from Testimony
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../belief-dynamics/epistemic-networks.html">
   Epistemic Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../belief-dynamics/polarization.html">
   Polarization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../belief-dynamics/deliberation.html">
   Deliberation
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Preference Dynamics and Voting
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="probmodels.html">
   Generating Preferences
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Polls and Deliberation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="grading-jury-theorem.html">
   Grading Jury Theorem
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/preference-aggregation/polls-deliberation.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/epacuit/ppe-simulations"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/epacuit/ppe-simulations/issues/new?title=Issue%20on%20page%20%2Fpreference-aggregation/polls-deliberation.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/epacuit/ppe-simulations/blob/master/preference-aggregation/polls-deliberation.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#swap-distance">
   Swap Distance
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#weak-rankings">
     Weak Rankings
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modified-ks-ranking">
   Modified KS Ranking
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#duddy-piggins-ordering">
   Duddy-Piggins Ordering
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#weak-ranking-profile">
   Weak Ranking Profile
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#polling-information">
   Polling Information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modeling-deliberation">
   Modeling Deliberation
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="polls-and-deliberation">
<h1>Polls and Deliberation<a class="headerlink" href="#polls-and-deliberation" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the Profile class</span>
<span class="kn">from</span> <span class="nn">voting.profiles</span> <span class="kn">import</span> <span class="n">Profile</span>
<span class="kn">from</span> <span class="nn">voting.generate_profiles</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">voting.voting_methods</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span><span class="p">,</span> <span class="n">permutations</span>

<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="swap-distance">
<h2>Swap Distance<a class="headerlink" href="#swap-distance" title="Permalink to this headline">¶</a></h2>
<p>The swap distance between <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(P'\)</span> is</p>
<div class="math notranslate nohighlight">
\[d_{KS}(P, P') = |\{\{a,b\} \mid a\mathrel{P} b\mbox{ and } b\mathrel{P}'a\}\]</div>
<p>This is also called the <strong>Kendall tau distance</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kendalltau_dist</span><span class="p">(</span><span class="n">rank_a</span><span class="p">,</span> <span class="n">rank_b</span><span class="p">):</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n_candidates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rank_a</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rank_a = </span><span class="si">{</span><span class="n">rank_a</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rank_b = </span><span class="si">{</span><span class="n">rank_b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_candidates</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;i=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, j=</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.sign(rank_a[i] - rank_a[j]) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rank_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">rank_a</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;np.sign(rank_b[i] - rank_b[j]) = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rank_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">rank_b</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">tau</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rank_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">rank_a</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span>
                <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rank_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">rank_b</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tau</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tau</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="n">r2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kendalltau_dist</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rank_a = [1, 2, 3, 4]
rank_b = [4, 3, 2, 1]
i=0, j=1
np.sign(rank_a[i] - rank_a[j]) = -1
np.sign(rank_b[i] - rank_b[j]) = 1
1
i=0, j=2
np.sign(rank_a[i] - rank_a[j]) = -1
np.sign(rank_b[i] - rank_b[j]) = 1
2
i=0, j=3
np.sign(rank_a[i] - rank_a[j]) = -1
np.sign(rank_b[i] - rank_b[j]) = 1
3
i=1, j=2
np.sign(rank_a[i] - rank_a[j]) = -1
np.sign(rank_b[i] - rank_b[j]) = 1
4
i=1, j=3
np.sign(rank_a[i] - rank_a[j]) = -1
np.sign(rank_b[i] - rank_b[j]) = 1
5
i=2, j=3
np.sign(rank_a[i] - rank_a[j]) = -1
np.sign(rank_b[i] - rank_b[j]) = 1
6
6
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Kemmeny-Young Method </span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">num_voters</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">prof</span> <span class="o">=</span> <span class="n">generate_profile</span><span class="p">(</span><span class="n">num_cands</span><span class="p">,</span> <span class="n">num_voters</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">rankings</span><span class="p">)</span>
<span class="n">prof</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">kendalltau_dist</span><span class="p">(</span><span class="n">rank_a</span><span class="p">,</span> <span class="n">rank_b</span><span class="p">):</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n_candidates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rank_a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_candidates</span><span class="p">),</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">tau</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rank_a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">rank_a</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span>
                <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">rank_b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">rank_b</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">tau</span>


<span class="n">rankings_dist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">ranking</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)):</span> 
    <span class="n">rankings_dist</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">ranking</span><span class="p">)]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">kendalltau_dist</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">ranking</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">prof</span><span class="o">.</span><span class="n">rankings</span><span class="p">)</span>

<span class="n">min_dist</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">rankings_dist</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">group_rankings</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rankings_dist</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">rankings_dist</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">==</span> <span class="n">min_dist</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The group rankings are </span><span class="si">{</span><span class="n">group_rankings</span><span class="si">}</span><span class="s2"> at a distance of </span><span class="si">{</span><span class="n">min_dist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(2, 1, 3, 0), (0, 2, 1, 3), (1, 3, 0, 2), (2, 3, 0, 1), (0, 3, 2, 1)]
+---+---+---+---+---+
| 1 | 1 | 1 | 1 | 1 |
+---+---+---+---+---+
| 2 | 0 | 1 | 2 | 0 |
| 1 | 2 | 3 | 3 | 3 |
| 3 | 1 | 0 | 0 | 2 |
| 0 | 3 | 2 | 1 | 1 |
+---+---+---+---+---+
The group rankings are [(0, 3, 1, 2)] at a distance of 9
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">true_rank</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">distances</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">true_rank</span><span class="p">))):</span> 
    <span class="n">distances</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">kendalltau_dist</span><span class="p">(</span><span class="n">true_rank</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

<span class="n">sorted_tuples</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sorted_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_tuples</span><span class="p">}</span>
<span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sorted_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sorted_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist between </span><span class="si">{</span><span class="n">true_rank</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">sorted_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">/</span> <span class="n">max_dist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dist between (0, 1, 2, 3) and (0, 1, 2, 3) is 0.0
dist between (0, 1, 2, 3) and (0, 1, 3, 2) is 0.16666666666666666
dist between (0, 1, 2, 3) and (0, 2, 1, 3) is 0.16666666666666666
dist between (0, 1, 2, 3) and (1, 0, 2, 3) is 0.16666666666666666
dist between (0, 1, 2, 3) and (0, 2, 3, 1) is 0.3333333333333333
dist between (0, 1, 2, 3) and (0, 3, 1, 2) is 0.3333333333333333
dist between (0, 1, 2, 3) and (1, 0, 3, 2) is 0.3333333333333333
dist between (0, 1, 2, 3) and (1, 2, 0, 3) is 0.3333333333333333
dist between (0, 1, 2, 3) and (2, 0, 1, 3) is 0.3333333333333333
dist between (0, 1, 2, 3) and (0, 3, 2, 1) is 0.5
dist between (0, 1, 2, 3) and (1, 2, 3, 0) is 0.5
dist between (0, 1, 2, 3) and (1, 3, 0, 2) is 0.5
dist between (0, 1, 2, 3) and (2, 0, 3, 1) is 0.5
dist between (0, 1, 2, 3) and (2, 1, 0, 3) is 0.5
dist between (0, 1, 2, 3) and (3, 0, 1, 2) is 0.5
dist between (0, 1, 2, 3) and (1, 3, 2, 0) is 0.6666666666666666
dist between (0, 1, 2, 3) and (2, 1, 3, 0) is 0.6666666666666666
dist between (0, 1, 2, 3) and (2, 3, 0, 1) is 0.6666666666666666
dist between (0, 1, 2, 3) and (3, 0, 2, 1) is 0.6666666666666666
dist between (0, 1, 2, 3) and (3, 1, 0, 2) is 0.6666666666666666
dist between (0, 1, 2, 3) and (2, 3, 1, 0) is 0.8333333333333334
dist between (0, 1, 2, 3) and (3, 1, 2, 0) is 0.8333333333333334
dist between (0, 1, 2, 3) and (3, 2, 0, 1) is 0.8333333333333334
dist between (0, 1, 2, 3) and (3, 2, 1, 0) is 1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">kendalltau</span>

<span class="n">true_rank</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">distances</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">true_rank</span><span class="p">))):</span> 
    <span class="n">distances</span><span class="p">[</span><span class="n">r</span><span class="p">],</span><span class="n">_</span> <span class="o">=</span> <span class="n">kendalltau</span><span class="p">(</span><span class="n">true_rank</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

<span class="n">sorted_tuples</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">sorted_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_tuples</span><span class="p">}</span>
<span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sorted_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sorted_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist between </span><span class="si">{</span><span class="n">true_rank</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">sorted_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dist between (0, 1, 2, 3) and (0, 1, 2, 3) is 1.0
dist between (0, 1, 2, 3) and (0, 1, 3, 2) is 0.6666666666666669
dist between (0, 1, 2, 3) and (0, 2, 1, 3) is 0.6666666666666669
dist between (0, 1, 2, 3) and (1, 0, 2, 3) is 0.6666666666666669
dist between (0, 1, 2, 3) and (0, 2, 3, 1) is 0.3333333333333334
dist between (0, 1, 2, 3) and (0, 3, 1, 2) is 0.3333333333333334
dist between (0, 1, 2, 3) and (1, 0, 3, 2) is 0.3333333333333334
dist between (0, 1, 2, 3) and (1, 2, 0, 3) is 0.3333333333333334
dist between (0, 1, 2, 3) and (2, 0, 1, 3) is 0.3333333333333334
dist between (0, 1, 2, 3) and (0, 3, 2, 1) is 0.0
dist between (0, 1, 2, 3) and (1, 2, 3, 0) is 0.0
dist between (0, 1, 2, 3) and (1, 3, 0, 2) is 0.0
dist between (0, 1, 2, 3) and (2, 0, 3, 1) is 0.0
dist between (0, 1, 2, 3) and (2, 1, 0, 3) is 0.0
dist between (0, 1, 2, 3) and (3, 0, 1, 2) is 0.0
dist between (0, 1, 2, 3) and (1, 3, 2, 0) is -0.3333333333333334
dist between (0, 1, 2, 3) and (2, 1, 3, 0) is -0.3333333333333334
dist between (0, 1, 2, 3) and (2, 3, 0, 1) is -0.3333333333333334
dist between (0, 1, 2, 3) and (3, 0, 2, 1) is -0.3333333333333334
dist between (0, 1, 2, 3) and (3, 1, 0, 2) is -0.3333333333333334
dist between (0, 1, 2, 3) and (2, 3, 1, 0) is -0.6666666666666669
dist between (0, 1, 2, 3) and (3, 1, 2, 0) is -0.6666666666666669
dist between (0, 1, 2, 3) and (3, 2, 0, 1) is -0.6666666666666669
dist between (0, 1, 2, 3) and (3, 2, 1, 0) is -1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cs_dist</span><span class="p">(</span><span class="n">rank_a</span><span class="p">,</span> <span class="n">rank_b</span><span class="p">):</span> 
    
    <span class="n">alts</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">rank_a</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">alts</span><span class="p">:</span> 
        <span class="n">d</span> <span class="o">+=</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">rank_a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">rank_b</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="n">r1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">r2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CS distance between </span><span class="si">{</span><span class="n">r1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">r2</span><span class="si">}</span><span class="s2"> is &quot;</span><span class="p">,</span> <span class="n">cs_dist</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CS distance between [0, 1, 2, 3] and [3, 2, 1, 0] is  8.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">true_rank</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">distances</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">true_rank</span><span class="p">))):</span> 
    <span class="n">distances</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">cs_dist</span><span class="p">(</span><span class="n">true_rank</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

<span class="n">sorted_tuples</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sorted_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_tuples</span><span class="p">}</span>
<span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sorted_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sorted_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist between </span><span class="si">{</span><span class="n">true_rank</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">sorted_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">/</span> <span class="n">max_dist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dist between (0, 1, 2, 3) and (0, 1, 2, 3) is 0.0
dist between (0, 1, 2, 3) and (0, 1, 3, 2) is 0.25
dist between (0, 1, 2, 3) and (0, 2, 1, 3) is 0.25
dist between (0, 1, 2, 3) and (1, 0, 2, 3) is 0.25
dist between (0, 1, 2, 3) and (0, 2, 3, 1) is 0.5
dist between (0, 1, 2, 3) and (0, 3, 1, 2) is 0.5
dist between (0, 1, 2, 3) and (0, 3, 2, 1) is 0.5
dist between (0, 1, 2, 3) and (1, 0, 3, 2) is 0.5
dist between (0, 1, 2, 3) and (1, 2, 0, 3) is 0.5
dist between (0, 1, 2, 3) and (2, 0, 1, 3) is 0.5
dist between (0, 1, 2, 3) and (2, 1, 0, 3) is 0.5
dist between (0, 1, 2, 3) and (1, 2, 3, 0) is 0.75
dist between (0, 1, 2, 3) and (1, 3, 0, 2) is 0.75
dist between (0, 1, 2, 3) and (1, 3, 2, 0) is 0.75
dist between (0, 1, 2, 3) and (2, 0, 3, 1) is 0.75
dist between (0, 1, 2, 3) and (2, 1, 3, 0) is 0.75
dist between (0, 1, 2, 3) and (3, 0, 1, 2) is 0.75
dist between (0, 1, 2, 3) and (3, 0, 2, 1) is 0.75
dist between (0, 1, 2, 3) and (3, 1, 0, 2) is 0.75
dist between (0, 1, 2, 3) and (3, 1, 2, 0) is 0.75
dist between (0, 1, 2, 3) and (2, 3, 0, 1) is 1.0
dist between (0, 1, 2, 3) and (2, 3, 1, 0) is 1.0
dist between (0, 1, 2, 3) and (3, 2, 0, 1) is 1.0
dist between (0, 1, 2, 3) and (3, 2, 1, 0) is 1.0
</pre></div>
</div>
</div>
</div>
<div class="section" id="weak-rankings">
<h3>Weak Rankings<a class="headerlink" href="#weak-rankings" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">wRanking</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">ranks</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span> <span class="o">=</span> <span class="n">cmap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cnum_to_cand</span> <span class="o">=</span> <span class="p">{</span><span class="n">cnum</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">cnum</span> <span class="ow">in</span> <span class="n">cmap</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span> <span class="o">=</span> <span class="n">ranks</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">_r_str</span> <span class="o">=</span> <span class="n">r_str</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">set_rank_list_from_str</span><span class="p">(</span><span class="n">r_str</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r_str</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">set_rank_str_from_rank_list</span><span class="p">(</span><span class="n">ranks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnum_to_cand</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rank_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rank_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cnum_to_cand</span><span class="p">[</span><span class="n">cnum</span><span class="p">]:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span><span class="p">[</span><span class="n">cnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">cnum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span><span class="p">))}</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">alts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_alts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_alts</span>
    
    <span class="k">def</span> <span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span>
    
    <span class="k">def</span> <span class="nf">cands_at_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rank</span><span class="p">):</span> 
        
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cnum_to_cand</span><span class="p">[</span><span class="n">cnum</span><span class="p">]</span> <span class="k">for</span> <span class="n">cnum</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="n">rank</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">R</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span> 
        
        <span class="n">c1_rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
        <span class="n">c2_rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c2_rank</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">c1_rank</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c1_rank</span> <span class="o">&lt;=</span> <span class="n">c2_rank</span><span class="p">))</span>
                
    <span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span> 
        
        <span class="n">c1_rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
        <span class="n">c2_rank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c2_rank</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c1_rank</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">c1_rank</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c1_rank</span> <span class="o">&lt;</span> <span class="n">c2_rank</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">I</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span> 
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">lift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cand</span><span class="p">,</span> <span class="n">rank</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;assumes that the ballot is complete and the only cands with no rank are at the bottom of the ranking&quot;&quot;&quot;</span>
        <span class="n">c_rank</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="p">[</span><span class="n">cand</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">_c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="p">[</span><span class="n">_c</span><span class="p">]]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="p">[</span><span class="n">_c</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="n">c_rank</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="p">[</span><span class="n">_c</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="p">[</span><span class="n">cand</span><span class="p">]]</span> <span class="o">=</span> <span class="n">rank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_rank_str_from_rank_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnum_to_cand</span><span class="p">)</span>        
        
    <span class="k">def</span> <span class="nf">judgement_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="n">j_set</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alts</span><span class="p">:</span> 
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">alts</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">d</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">):</span> 
                        <span class="n">j_set</span><span class="p">[(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">j_set</span><span class="p">[(</span><span class="n">d</span><span class="p">,</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">c</span><span class="p">):</span> 
                        <span class="n">j_set</span><span class="p">[(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">j_set</span><span class="p">[(</span><span class="n">d</span><span class="p">,</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>  
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">):</span> 
                        <span class="n">j_set</span><span class="p">[(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">j_set</span><span class="p">[(</span><span class="n">d</span><span class="p">,</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">j_set</span>
        
    <span class="k">def</span> <span class="nf">set_rank_list_from_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_str</span><span class="p">,</span> <span class="n">cmap</span><span class="p">):</span>
        
        <span class="n">cname_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">bits</span> <span class="o">=</span> <span class="n">r_str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="n">ranks</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pos</span>  <span class="o">=</span> <span class="mi">0</span>
        <span class="n">rank</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">):</span> 
            <span class="k">if</span> <span class="n">bits</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">partial</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">ranks</span><span class="p">[</span><span class="n">cmap</span><span class="p">[</span><span class="n">cname_type</span><span class="p">(</span><span class="n">bits</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))]]</span> <span class="o">=</span> <span class="n">rank</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">bits</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ranks</span><span class="p">[</span><span class="n">cmap</span><span class="p">[</span><span class="n">cname_type</span><span class="p">(</span><span class="n">bits</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))]]</span> <span class="o">=</span> <span class="n">rank</span>
                <span class="n">rank</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">partial</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">ranks</span><span class="p">[</span><span class="n">cmap</span><span class="p">[</span><span class="n">cname_type</span><span class="p">(</span><span class="n">bits</span><span class="p">[</span><span class="n">pos</span><span class="p">])]]</span> <span class="o">=</span> <span class="n">rank</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">partial</span><span class="p">:</span> 
                    <span class="n">rank</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">_ranks</span> <span class="o">=</span> <span class="n">ranks</span>
        
    
    <span class="k">def</span> <span class="nf">set_rank_str_from_rank_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_list</span><span class="p">,</span> <span class="n">cnum_to_cand</span><span class="p">):</span>
        
        <span class="n">r_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cnum_to_cand</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span> 
            <span class="n">cs_at_rank</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">cnum_to_cand</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">cr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">r_list</span><span class="p">)</span> <span class="k">if</span> <span class="n">cr</span> <span class="o">==</span> <span class="n">r</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cs_at_rank</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
                <span class="n">r_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cs_at_rank</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">,&quot;</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cs_at_rank</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> 
                <span class="n">r_str</span>  <span class="o">+=</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cs_at_rank</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;},&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_r_str</span> <span class="o">=</span> <span class="n">r_str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># remove last ,</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_r_str</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;1,{2,5},{4,0},6&quot;</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cmap&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">r_str</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">rank_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">rank_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R(1,2)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R(2,1)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P(1,2)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P(2,1)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I(1,2)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I(2,1)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R(2,5)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R(5,2)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P(2,5)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P(5,2)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I(2,5)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I(5,2)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R(0,3)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R(3,0)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R(3,3)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">R</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P(0,3)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P(3,0)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;P(3,3)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I(0,3)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I(3,0)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I(3,3)&quot;</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">judgement_set</span><span class="p">())</span>

<span class="n">r2</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;0,1,2,3&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
<span class="n">r2</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cmap {0: 0, 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6}


[3, 1, 2, None, 3, 2, 4]
{0: 3, 1: 1, 2: 2, 3: None, 4: 3, 5: 2, 6: 4}
1,{2,5},{4,0},6
-----
R(1,2) True
R(2,1) False
P(1,2) True
P(2,1) False
I(1,2) False
I(2,1) False
-
R(2,5) True
R(5,2) True
P(2,5) False
P(5,2) False
I(2,5) True
I(5,2) True
-
R(0,3) True
R(3,0) False
R(3,3) True
P(0,3) True
P(3,0) False
P(3,3) False
I(0,3) False
I(3,0) False
I(3,3) True
{(0, 1): False, (1, 0): True, (0, 2): False, (2, 0): True, (0, 3): True, (3, 0): False, (0, 4): True, (4, 0): True, (0, 5): False, (5, 0): True, (0, 6): True, (6, 0): False, (1, 2): True, (2, 1): False, (1, 3): True, (3, 1): False, (1, 4): True, (4, 1): False, (1, 5): True, (5, 1): False, (1, 6): True, (6, 1): False, (2, 3): True, (3, 2): False, (2, 4): True, (4, 2): False, (2, 5): True, (5, 2): True, (2, 6): True, (6, 2): False, (3, 4): False, (4, 3): True, (3, 5): False, (5, 3): True, (3, 6): False, (6, 3): True, (4, 5): False, (5, 4): True, (4, 6): True, (6, 4): False, (5, 6): True, (6, 5): False}
0,1,2,3
2,0,1,3
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="modified-ks-ranking">
<h2>Modified KS Ranking<a class="headerlink" href="#modified-ks-ranking" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_ks_dist</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">wr1</span><span class="p">,</span> <span class="n">wr2</span><span class="p">):</span> 
    
    <span class="n">dist</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">wr1</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">wr2</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span> 
        <span class="n">dist</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">wr1</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">wr2</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">wr1</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">wr2</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">dist</span>

<span class="k">def</span> <span class="nf">ks_dist</span><span class="p">(</span><span class="n">wr1</span><span class="p">,</span> <span class="n">wr2</span><span class="p">):</span> 
    
    <span class="k">assert</span> <span class="n">wr1</span><span class="o">.</span><span class="n">alts</span> <span class="o">==</span> <span class="n">wr2</span><span class="o">.</span><span class="n">alts</span><span class="p">,</span> <span class="s2">&quot;Rankings must be based on the same set of alternatives&quot;</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">wr1</span><span class="o">.</span><span class="n">alts</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">wr1</span><span class="o">.</span><span class="n">alts</span><span class="p">:</span> 
            <span class="n">dist</span> <span class="o">+=</span> <span class="n">_ks_dist</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">wr1</span><span class="p">,</span> <span class="n">wr2</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">dist</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>      
<span class="n">r1</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;0,1,2,3&quot;</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;1,0,2,3&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ks_dist</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span><span class="n">r2</span><span class="p">))</span>

    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">true_ranking</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>  
<span class="n">true_rank</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">true_ranking</span><span class="p">]))</span>
<span class="n">distances</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">true_rank</span><span class="o">.</span><span class="n">alts</span><span class="p">))):</span> 
    <span class="n">r</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">perm</span><span class="p">]))</span>
    <span class="n">distances</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">ks_dist</span><span class="p">(</span><span class="n">true_rank</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<span class="n">sorted_tuples</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sorted_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_tuples</span><span class="p">}</span>
<span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sorted_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">max_dist</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sorted_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist between </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">true_rank</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">sorted_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">/</span> <span class="n">max_dist</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12
dist between 1,2,3,4 and 1,2,3,4 is 0.0
dist between 1,2,3,4 and 1,2,4,3 is 0.1667
dist between 1,2,3,4 and 1,3,2,4 is 0.1667
dist between 1,2,3,4 and 2,1,3,4 is 0.1667
dist between 1,2,3,4 and 1,3,4,2 is 0.3333
dist between 1,2,3,4 and 1,4,2,3 is 0.3333
dist between 1,2,3,4 and 2,1,4,3 is 0.3333
dist between 1,2,3,4 and 2,3,1,4 is 0.3333
dist between 1,2,3,4 and 3,1,2,4 is 0.3333
dist between 1,2,3,4 and 1,4,3,2 is 0.5
dist between 1,2,3,4 and 2,3,4,1 is 0.5
dist between 1,2,3,4 and 2,4,1,3 is 0.5
dist between 1,2,3,4 and 3,1,4,2 is 0.5
dist between 1,2,3,4 and 3,2,1,4 is 0.5
dist between 1,2,3,4 and 4,1,2,3 is 0.5
dist between 1,2,3,4 and 2,4,3,1 is 0.6667
dist between 1,2,3,4 and 3,2,4,1 is 0.6667
dist between 1,2,3,4 and 3,4,1,2 is 0.6667
dist between 1,2,3,4 and 4,1,3,2 is 0.6667
dist between 1,2,3,4 and 4,2,1,3 is 0.6667
dist between 1,2,3,4 and 3,4,2,1 is 0.8333
dist between 1,2,3,4 and 4,2,3,1 is 0.8333
dist between 1,2,3,4 and 4,3,1,2 is 0.8333
dist between 1,2,3,4 and 4,3,2,1 is 1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">modified_ks_dist</span><span class="p">(</span><span class="n">wr1</span><span class="p">,</span> <span class="n">wr2</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span> 
    
    <span class="k">assert</span> <span class="n">wr1</span><span class="o">.</span><span class="n">alts</span> <span class="o">==</span> <span class="n">wr2</span><span class="o">.</span><span class="n">alts</span><span class="p">,</span> <span class="s2">&quot;Rankings must be based on the same set of alternatives&quot;</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_alts</span> <span class="o">=</span> <span class="n">wr1</span><span class="o">.</span><span class="n">num_alts</span>
    <span class="n">alts</span> <span class="o">=</span> <span class="n">wr1</span><span class="o">.</span><span class="n">alts</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">alts</span><span class="p">:</span> 
        <span class="n">w</span> <span class="o">=</span> <span class="p">((</span><span class="n">num_alts</span> <span class="o">-</span> <span class="n">wr1</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">theta</span>
        <span class="c1">#print(w)</span>
        <span class="n">dist</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">*</span> <span class="p">((</span><span class="nb">sum</span><span class="p">([</span><span class="n">_ks_dist</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">wr1</span><span class="p">,</span> <span class="n">wr2</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">alts</span><span class="p">]))</span> <span class="o">**</span> <span class="n">nu</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">dist</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">true_ranking</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>  
<span class="n">true_rank</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">true_ranking</span><span class="p">]))</span>
<span class="n">distances</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">true_rank</span><span class="o">.</span><span class="n">alts</span><span class="p">))):</span> 
    <span class="n">r</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">perm</span><span class="p">]))</span>
    <span class="n">distances</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">modified_ks_dist</span><span class="p">(</span><span class="n">true_rank</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
<span class="n">sorted_tuples</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sorted_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_tuples</span><span class="p">}</span>
<span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sorted_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">max_dist</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sorted_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist between </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">true_rank</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">sorted_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">/</span> <span class="n">max_dist</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>15.120955864630135
dist between 1,2,3,4 and 1,2,3,4 is 0.0
dist between 1,2,3,4 and 1,2,4,3 is 0.1323
dist between 1,2,3,4 and 1,3,2,4 is 0.1871
dist between 1,2,3,4 and 2,1,3,4 is 0.2291
dist between 1,2,3,4 and 1,4,2,3 is 0.2645
dist between 1,2,3,4 and 1,3,4,2 is 0.3193
dist between 1,2,3,4 and 2,1,4,3 is 0.3614
dist between 1,2,3,4 and 3,1,2,4 is 0.3741
dist between 1,2,3,4 and 4,1,2,3 is 0.3968
dist between 1,2,3,4 and 2,3,1,4 is 0.4161
dist between 1,2,3,4 and 1,4,3,2 is 0.4516
dist between 1,2,3,4 and 2,4,1,3 is 0.4936
dist between 1,2,3,4 and 3,1,4,2 is 0.5064
dist between 1,2,3,4 and 2,3,4,1 is 0.5484
dist between 1,2,3,4 and 4,1,3,2 is 0.5839
dist between 1,2,3,4 and 3,2,1,4 is 0.6032
dist between 1,2,3,4 and 4,2,1,3 is 0.6259
dist between 1,2,3,4 and 3,4,1,2 is 0.6386
dist between 1,2,3,4 and 2,4,3,1 is 0.6807
dist between 1,2,3,4 and 3,2,4,1 is 0.7355
dist between 1,2,3,4 and 4,3,1,2 is 0.7709
dist between 1,2,3,4 and 4,2,3,1 is 0.8129
dist between 1,2,3,4 and 3,4,2,1 is 0.8677
dist between 1,2,3,4 and 4,3,2,1 is 1.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="duddy-piggins-ordering">
<h2>Duddy-Piggins Ordering<a class="headerlink" href="#duddy-piggins-ordering" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">between</span><span class="p">(</span><span class="n">wr1</span><span class="p">,</span> <span class="n">wr2</span><span class="p">,</span> <span class="n">wr3</span><span class="p">):</span> 
    <span class="sd">&#39;&#39;&#39;return True if wr2 is between wr1 and wr3&#39;&#39;&#39;</span>
    <span class="n">is_between</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">wr1_js</span> <span class="o">=</span> <span class="n">wr1</span><span class="o">.</span><span class="n">judgement_set</span><span class="p">()</span>
    <span class="n">wr2_js</span> <span class="o">=</span> <span class="n">wr2</span><span class="o">.</span><span class="n">judgement_set</span><span class="p">()</span>
    <span class="n">wr3_js</span> <span class="o">=</span> <span class="n">wr3</span><span class="o">.</span><span class="n">judgement_set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">wr1</span><span class="o">.</span><span class="n">alts</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">wr1</span><span class="o">.</span><span class="n">alts</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">d</span><span class="p">:</span> 
                <span class="n">is_between</span> <span class="o">=</span> <span class="n">is_between</span> <span class="ow">and</span> <span class="p">(</span><span class="n">wr2_js</span><span class="p">[(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span> <span class="o">==</span> <span class="n">wr1_js</span><span class="p">[(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span> <span class="ow">or</span> <span class="n">wr2_js</span><span class="p">[(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span> <span class="o">==</span> <span class="n">wr3_js</span><span class="p">[(</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)])</span> 
    <span class="k">return</span> <span class="n">is_between</span>    
<span class="n">r1_str</span> <span class="o">=</span> <span class="s2">&quot;1,2,3&quot;</span>
<span class="n">r2_str1</span> <span class="o">=</span> <span class="s2">&quot;1,{2,3}&quot;</span>
<span class="n">r2_str2</span> <span class="o">=</span> <span class="s2">&quot;{1,2,3}&quot;</span>
<span class="c1">#r2_str3 = &quot;3,{1,2}&quot;</span>
<span class="c1">#r3_str = &quot;3,2,1&quot;</span>
<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1">#0,1,2 0,{1,2} 0,2,1</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>
<span class="n">wr1</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">r1_str</span><span class="p">)</span>
<span class="n">wr2</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">r2_str1</span><span class="p">)</span>
<span class="n">wr3</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">r2_str2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">wr2</span><span class="si">}</span><span class="s2"> is between </span><span class="si">{</span><span class="n">wr1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">wr3</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wr1 js &quot;</span><span class="p">,</span> <span class="n">wr1</span><span class="o">.</span><span class="n">judgement_set</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wr2 js &quot;</span><span class="p">,</span> <span class="n">wr2</span><span class="o">.</span><span class="n">judgement_set</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wr3 js &quot;</span><span class="p">,</span> <span class="n">wr3</span><span class="o">.</span><span class="n">judgement_set</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">between</span><span class="p">(</span><span class="n">wr1</span><span class="p">,</span> <span class="n">wr2</span><span class="p">,</span> <span class="n">wr3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1,{2,3} is between 1,2,3 and {1,2,3}
wr1 js  {(1, 2): True, (2, 1): False, (1, 3): True, (3, 1): False, (2, 3): True, (3, 2): False}
wr2 js  {(1, 2): True, (2, 1): False, (1, 3): True, (3, 1): False, (2, 3): True, (3, 2): True}
wr3 js  {(1, 2): True, (2, 1): True, (1, 3): True, (3, 1): True, (2, 3): True, (3, 2): True}
True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>

<span class="k">def</span> <span class="nf">weakorders</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">A</span><span class="p">:</span>  <span class="c1"># i.e., A is empty</span>
        <span class="k">yield</span> <span class="p">[]</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>  <span class="c1"># i.e., all nonempty subsets B</span>
            <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">weakorders</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">B</span><span class="p">)):</span>
                <span class="k">yield</span> <span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">+</span> <span class="n">order</span>
                
<span class="n">weak_orders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">3</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
    <span class="mi">4</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
    <span class="mi">5</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
    <span class="mi">6</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
    <span class="mi">7</span><span class="p">:</span> <span class="nb">list</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">num_cands</span> <span class="ow">in</span> <span class="n">weak_orders</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>
    <span class="k">for</span> <span class="n">wr</span> <span class="ow">in</span> <span class="n">weakorders</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)):</span>
        <span class="n">wr_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">_cl</span> <span class="ow">in</span> <span class="n">wr</span><span class="p">:</span> 
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_cl</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
                <span class="n">wr_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">_cl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">wr_str</span> <span class="o">+=</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">_cl</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;},&quot;</span>
        <span class="n">weak_orders</span><span class="p">[</span><span class="n">num_cands</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">wr_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">lin_orders</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">3</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
    <span class="mi">4</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
    <span class="mi">5</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
    <span class="mi">6</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
    <span class="mi">7</span><span class="p">:</span> <span class="nb">list</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">num_cands</span> <span class="ow">in</span> <span class="n">lin_orders</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>
    <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)):</span>
        <span class="n">lr_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">lr</span><span class="p">))</span>
        <span class="c1">#print(lr_str)</span>
        <span class="n">lin_orders</span><span class="p">[</span><span class="n">num_cands</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">lr_str</span><span class="p">))</span>

<span class="c1">#print(lin_orders)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="n">ranking_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">ranking_graph</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span> <span class="k">for</span> <span class="n">wr</span> <span class="ow">in</span> <span class="n">weak_orders</span><span class="p">[</span><span class="n">num_cands</span><span class="p">]])</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>
<span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="n">ranking_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> 
    <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="n">ranking_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n1</span> <span class="o">!=</span> <span class="n">n2</span><span class="p">:</span>
            <span class="n">add_edge</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">wr1</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">n1</span><span class="p">)</span>
            <span class="n">wr2</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">n2</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">wr</span> <span class="ow">in</span> <span class="n">weak_orders</span><span class="p">[</span><span class="n">num_cands</span><span class="p">]:</span> 
                
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n1</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n2</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="n">between</span><span class="p">(</span><span class="n">wr1</span><span class="p">,</span><span class="n">wr</span><span class="p">,</span><span class="n">wr2</span><span class="p">):</span> 
                        <span class="n">add_edge</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">add_edge</span><span class="p">:</span> 
                <span class="n">ranking_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span>
    
<span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">ranking_graph</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">ranking_graph</span><span class="p">),</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">2700</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">ranking_graph</span><span class="p">,</span> <span class="s2">&quot;0,1,2&quot;</span><span class="p">,</span> <span class="s2">&quot;2,1,0&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
<img alt="../_images/polls-deliberation_20_1.png" src="../_images/polls-deliberation_20_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ranking_graphs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="k">for</span> <span class="n">num_cands</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)</span>
    <span class="n">ranking_graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    <span class="n">ranking_graph</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span> <span class="k">for</span> <span class="n">wr</span> <span class="ow">in</span> <span class="n">weak_orders</span><span class="p">[</span><span class="n">num_cands</span><span class="p">]])</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>
    <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="n">ranking_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> 
        <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="n">ranking_graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n1</span> <span class="o">!=</span> <span class="n">n2</span><span class="p">:</span>
                <span class="n">add_edge</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">wr1</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">n1</span><span class="p">)</span>
                <span class="n">wr2</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">n2</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">wr</span> <span class="ow">in</span> <span class="n">weak_orders</span><span class="p">[</span><span class="n">num_cands</span><span class="p">]:</span> 

                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n1</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n2</span><span class="p">:</span> 
                        <span class="k">if</span> <span class="n">between</span><span class="p">(</span><span class="n">wr1</span><span class="p">,</span><span class="n">wr</span><span class="p">,</span><span class="n">wr2</span><span class="p">):</span> 
                            <span class="n">add_edge</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">add_edge</span><span class="p">:</span> 
                    <span class="n">ranking_graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">)</span>
    <span class="n">ranking_graphs</span><span class="p">[</span><span class="n">num_cands</span><span class="p">]</span><span class="o">=</span><span class="n">ranking_graph</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">dp_dist</span><span class="p">(</span><span class="n">wr1</span><span class="p">,</span> <span class="n">wr2</span><span class="p">):</span>
    
    <span class="n">ranking_graph</span> <span class="o">=</span> <span class="n">ranking_graphs</span><span class="p">[</span><span class="n">wr1</span><span class="o">.</span><span class="n">num_alts</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">ranking_graph</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">wr1</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">wr2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">true_ranking</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>  
<span class="n">true_rank</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">true_ranking</span><span class="p">]))</span>
<span class="n">distances</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">true_rank</span><span class="o">.</span><span class="n">alts</span><span class="p">))):</span> 
    <span class="n">r</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">perm</span><span class="p">]))</span>
    <span class="n">distances</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">dp_dist</span><span class="p">(</span><span class="n">true_rank</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<span class="n">sorted_tuples</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sorted_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_tuples</span><span class="p">}</span>
<span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sorted_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">max_dist</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sorted_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist between </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">true_rank</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">sorted_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">/</span> <span class="n">max_dist</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6
dist between 0,1,2,3 and 0,1,2,3 is 0.0
dist between 0,1,2,3 and 0,1,3,2 is 0.3333
dist between 0,1,2,3 and 0,2,1,3 is 0.3333
dist between 0,1,2,3 and 1,0,2,3 is 0.3333
dist between 0,1,2,3 and 0,2,3,1 is 0.6667
dist between 0,1,2,3 and 0,3,1,2 is 0.6667
dist between 0,1,2,3 and 0,3,2,1 is 0.6667
dist between 0,1,2,3 and 1,0,3,2 is 0.6667
dist between 0,1,2,3 and 1,2,0,3 is 0.6667
dist between 0,1,2,3 and 2,0,1,3 is 0.6667
dist between 0,1,2,3 and 2,1,0,3 is 0.6667
dist between 0,1,2,3 and 1,2,3,0 is 1.0
dist between 0,1,2,3 and 1,3,0,2 is 1.0
dist between 0,1,2,3 and 1,3,2,0 is 1.0
dist between 0,1,2,3 and 2,0,3,1 is 1.0
dist between 0,1,2,3 and 2,1,3,0 is 1.0
dist between 0,1,2,3 and 2,3,0,1 is 1.0
dist between 0,1,2,3 and 2,3,1,0 is 1.0
dist between 0,1,2,3 and 3,0,1,2 is 1.0
dist between 0,1,2,3 and 3,0,2,1 is 1.0
dist between 0,1,2,3 and 3,1,0,2 is 1.0
dist between 0,1,2,3 and 3,1,2,0 is 1.0
dist between 0,1,2,3 and 3,2,0,1 is 1.0
dist between 0,1,2,3 and 3,2,1,0 is 1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">true_ranking</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">theta</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>  
<span class="n">true_rank</span> <span class="o">=</span> <span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">true_ranking</span><span class="p">]))</span>
<span class="n">distances</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">weak_orders</span><span class="p">[</span><span class="n">num_cands</span><span class="p">]:</span> 
    <span class="c1">#r = wRanking(cmap, r_str=&quot;,&quot;.join([str(c) for c in perm]))</span>
    <span class="n">distances</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">dp_dist</span><span class="p">(</span><span class="n">true_rank</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<span class="n">sorted_tuples</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">distances</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">sorted_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sorted_tuples</span><span class="p">}</span>
<span class="n">max_dist</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sorted_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">max_dist</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">sorted_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dist between </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">true_rank</span><span class="p">)</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">sorted_dict</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">/</span> <span class="n">max_dist</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6
dist between 0,1,2,3 and 0,1,2,3 is 0.0
dist between 0,1,2,3 and 0,1,{2,3} is 0.1667
dist between 0,1,2,3 and 0,{1,2},3 is 0.1667
dist between 0,1,2,3 and {0,1},2,3 is 0.1667
dist between 0,1,2,3 and 0,1,3,2 is 0.3333
dist between 0,1,2,3 and 0,2,1,3 is 0.3333
dist between 0,1,2,3 and 0,{1,2,3} is 0.3333
dist between 0,1,2,3 and 1,0,2,3 is 0.3333
dist between 0,1,2,3 and {0,1},{2,3} is 0.3333
dist between 0,1,2,3 and {0,1,2},3 is 0.3333
dist between 0,1,2,3 and 0,2,{1,3} is 0.5
dist between 0,1,2,3 and 0,3,{1,2} is 0.5
dist between 0,1,2,3 and 0,{1,3},2 is 0.5
dist between 0,1,2,3 and 0,{2,3},1 is 0.5
dist between 0,1,2,3 and 1,0,{2,3} is 0.5
dist between 0,1,2,3 and 1,{0,2},3 is 0.5
dist between 0,1,2,3 and 2,{0,1},3 is 0.5
dist between 0,1,2,3 and {0,1},3,2 is 0.5
dist between 0,1,2,3 and {0,2},1,3 is 0.5
dist between 0,1,2,3 and {1,2},0,3 is 0.5
dist between 0,1,2,3 and {0,1,2,3} is 0.5
dist between 0,1,2,3 and 0,2,3,1 is 0.6667
dist between 0,1,2,3 and 0,3,1,2 is 0.6667
dist between 0,1,2,3 and 0,3,2,1 is 0.6667
dist between 0,1,2,3 and 1,0,3,2 is 0.6667
dist between 0,1,2,3 and 1,2,0,3 is 0.6667
dist between 0,1,2,3 and 1,{0,2,3} is 0.6667
dist between 0,1,2,3 and 2,0,1,3 is 0.6667
dist between 0,1,2,3 and 2,1,0,3 is 0.6667
dist between 0,1,2,3 and 2,{0,1,3} is 0.6667
dist between 0,1,2,3 and 3,{0,1,2} is 0.6667
dist between 0,1,2,3 and {0,2},{1,3} is 0.6667
dist between 0,1,2,3 and {0,3},{1,2} is 0.6667
dist between 0,1,2,3 and {1,2},{0,3} is 0.6667
dist between 0,1,2,3 and {1,3},{0,2} is 0.6667
dist between 0,1,2,3 and {2,3},{0,1} is 0.6667
dist between 0,1,2,3 and {0,1,3},2 is 0.6667
dist between 0,1,2,3 and {0,2,3},1 is 0.6667
dist between 0,1,2,3 and {1,2,3},0 is 0.6667
dist between 0,1,2,3 and 1,2,{0,3} is 0.8333
dist between 0,1,2,3 and 1,3,{0,2} is 0.8333
dist between 0,1,2,3 and 1,{0,3},2 is 0.8333
dist between 0,1,2,3 and 1,{2,3},0 is 0.8333
dist between 0,1,2,3 and 2,0,{1,3} is 0.8333
dist between 0,1,2,3 and 2,1,{0,3} is 0.8333
dist between 0,1,2,3 and 2,3,{0,1} is 0.8333
dist between 0,1,2,3 and 2,{0,3},1 is 0.8333
dist between 0,1,2,3 and 2,{1,3},0 is 0.8333
dist between 0,1,2,3 and 3,0,{1,2} is 0.8333
dist between 0,1,2,3 and 3,1,{0,2} is 0.8333
dist between 0,1,2,3 and 3,2,{0,1} is 0.8333
dist between 0,1,2,3 and 3,{0,1},2 is 0.8333
dist between 0,1,2,3 and 3,{0,2},1 is 0.8333
dist between 0,1,2,3 and 3,{1,2},0 is 0.8333
dist between 0,1,2,3 and {0,2},3,1 is 0.8333
dist between 0,1,2,3 and {0,3},1,2 is 0.8333
dist between 0,1,2,3 and {0,3},2,1 is 0.8333
dist between 0,1,2,3 and {1,2},3,0 is 0.8333
dist between 0,1,2,3 and {1,3},0,2 is 0.8333
dist between 0,1,2,3 and {1,3},2,0 is 0.8333
dist between 0,1,2,3 and {2,3},0,1 is 0.8333
dist between 0,1,2,3 and {2,3},1,0 is 0.8333
dist between 0,1,2,3 and 1,2,3,0 is 1.0
dist between 0,1,2,3 and 1,3,0,2 is 1.0
dist between 0,1,2,3 and 1,3,2,0 is 1.0
dist between 0,1,2,3 and 2,0,3,1 is 1.0
dist between 0,1,2,3 and 2,1,3,0 is 1.0
dist between 0,1,2,3 and 2,3,0,1 is 1.0
dist between 0,1,2,3 and 2,3,1,0 is 1.0
dist between 0,1,2,3 and 3,0,1,2 is 1.0
dist between 0,1,2,3 and 3,0,2,1 is 1.0
dist between 0,1,2,3 and 3,1,0,2 is 1.0
dist between 0,1,2,3 and 3,1,2,0 is 1.0
dist between 0,1,2,3 and 3,2,0,1 is 1.0
dist between 0,1,2,3 and 3,2,1,0 is 1.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="weak-ranking-profile">
<h2>Weak Ranking Profile<a class="headerlink" href="#weak-ranking-profile" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tabulate</span>  <span class="kn">import</span> <span class="n">tabulate</span>
<span class="k">class</span> <span class="nc">wProfile</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A profile of strict weak orderings</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rankings</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">,</span> <span class="n">rcounts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a profile</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">num_cands</span> <span class="o">=</span> <span class="n">num_cands</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cand_nums</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span> <span class="o">=</span> <span class="n">cmap</span> <span class="k">if</span> <span class="n">cmap</span> <span class="k">else</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cnum_to_cand</span> <span class="o">=</span> <span class="p">{</span><span class="n">cnum</span><span class="p">:</span> <span class="n">c</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">cnum</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_rankings</span> <span class="o">=</span> <span class="p">[</span><span class="n">wRanking</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="n">r_str</span><span class="p">)</span> <span class="k">for</span> <span class="n">r_str</span> <span class="ow">in</span> <span class="n">rankings</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rcounts</span> <span class="o">=</span> <span class="n">rcounts</span> <span class="k">if</span> <span class="n">rcounts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">rankings</span><span class="p">)</span>

        <span class="c1"># total number of voters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_voters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rcounts</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rankings_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># getter function to get the rankings and rcounts</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rcounts</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rankings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="c1"># get the list of rankings</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">ridx</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rankings</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rcounts</span><span class="p">[</span><span class="n">ridx</span><span class="p">])]</span>
    
    <span class="nd">@property</span> 
    <span class="k">def</span> <span class="nf">candidates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cand_to_cnum</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    
    <span class="k">def</span> <span class="nf">support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
        <span class="c1"># the number of voters that rank c1 strictly above c2 </span>
        <span class="c1"># wrapper function that calls the compiled _support function</span>

        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">rcount</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">P</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span> <span class="k">else</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">rcount</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rankings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rcounts</span><span class="p">)])</span>
    
    <span class="k">def</span> <span class="nf">margin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
        <span class="c1"># the number of voters that rank c1 over c2 minus the number</span>
        <span class="c1">#   that rank c2 over c2.</span>
        <span class="c1"># wrapper function that calls the compiled _margin function</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">support</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">support</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">c1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">majority_prefers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span> 
        <span class="c1"># return True if more voters rank c1 over c2 than c2 over c1</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">condorcet_winner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return the Condorcet winner --- a candidate that is majority preferred to every other candidate</span>
        <span class="c1"># if a Condorcet winner doesn&#39;t exist, return None</span>
        
        <span class="n">cw</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="p">:</span> 
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">majority_prefers</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span> <span class="k">for</span> <span class="n">c2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">c2</span><span class="p">]):</span> 
                <span class="n">cw</span> <span class="o">=</span> <span class="n">c</span>
                <span class="k">break</span> <span class="c1"># if a Condorcet winner exists, then it is unique</span>
        <span class="k">return</span> <span class="n">cw</span>

    <span class="k">def</span> <span class="nf">weak_condorcet_winner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return the set of Weak Condorcet winner --- candidate c is a weak Condorcet winner if there </span>
        <span class="c1"># is no other candidate majority preferred to c. Note that unlike with Condorcet winners, there </span>
        <span class="c1"># may be more than one weak Condorcet winner.</span>
        <span class="c1"># if a weak Condorcet winner doesn&#39;t exist, return None</span>
        
        <span class="n">weak_cw</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="p">:</span> 
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">majority_prefers</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">c2</span><span class="p">]):</span> 
                <span class="n">weak_cw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">weak_cw</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">weak_cw</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">condorcet_loser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return the Condorcet loser --- a candidate that is majority preferred by every other candidate</span>
        <span class="c1"># if a Condorcet loser doesn&#39;t exist, return None</span>
        
        <span class="n">cl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="p">:</span> 
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">majority_prefers</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">c2</span><span class="p">]):</span> 
                <span class="n">cl</span> <span class="o">=</span> <span class="n">c</span>
                <span class="k">break</span> <span class="c1"># if a Condorcet loser exists, then it is unique</span>
        <span class="k">return</span> <span class="n">cl</span>
    
    <span class="k">def</span> <span class="nf">strict_maj_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return the size of  strictly more than 50% of the voters</span>
        
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_voters</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_voters</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_voters</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">margin_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
        <span class="c1"># generate the margin graph (i.e., the weighted majority graph)</span>
    
        <span class="n">mg</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
        <span class="n">mg</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="p">)</span>
        <span class="n">mg</span><span class="o">.</span><span class="n">add_weighted_edges_from</span><span class="p">([(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">))</span>
                                    <span class="k">for</span> <span class="n">c1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span> 
                                    <span class="k">for</span> <span class="n">c2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c1</span> <span class="o">!=</span> <span class="n">c2</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">majority_prefers</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">mg</span>

    
    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pretty&quot;</span><span class="p">):</span>
        <span class="c1"># display a profile</span>
        <span class="c1"># style defaults to &quot;pretty&quot; (the PrettyTable formatting)</span>
        <span class="c1"># other stype options is &quot;latex&quot; or &quot;fancy_grid&quot; (or any style option for tabulate)</span>
        
        
        <span class="n">possible_ranks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_cands</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">tbl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">possible_ranks</span><span class="p">:</span> 
            <span class="n">tbl</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">wr</span><span class="o">.</span><span class="n">cands_at_rank</span><span class="p">(</span><span class="n">r</span><span class="p">)))</span> <span class="k">for</span> <span class="n">wr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rankings</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">_rcounts</span><span class="p">,</span> 
                       <span class="n">tablefmt</span><span class="o">=</span><span class="n">style</span><span class="p">))</span>        
        
    <span class="k">def</span> <span class="nf">display_margin_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># display the margin graph</span>
        
        <span class="c1"># create the margin graph.   The reason not to call the above method margin_graph </span>
        <span class="c1"># is that we may want to apply the cmap to the names of the candidates</span>
        
        
        <span class="n">mg</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
        <span class="n">mg</span><span class="o">.</span><span class="n">add_nodes_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">candidates</span><span class="p">)</span>
        <span class="n">mg</span><span class="o">.</span><span class="n">add_weighted_edges_from</span><span class="p">([(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">))</span>
                                    <span class="k">for</span> <span class="n">c1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span> 
                                    <span class="k">for</span> <span class="n">c2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candidates</span> <span class="k">if</span> <span class="n">c1</span> <span class="o">!=</span> <span class="n">c2</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">majority_prefers</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)])</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">mg</span><span class="p">)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> 
                <span class="n">font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> 
                <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_edge_attributes</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edge_labels</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edge_labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">label_pos</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">rankings</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;3,0,1,2&quot;</span><span class="p">,</span> <span class="s2">&quot;0,3,{1,2}&quot;</span><span class="p">,</span> <span class="s2">&quot;{0,1,2}&quot;</span><span class="p">,</span> <span class="s2">&quot;2,3,{0,1}&quot;</span><span class="p">]</span>

<span class="n">prf</span> <span class="o">=</span> <span class="n">wProfile</span><span class="p">(</span><span class="n">rankings</span><span class="p">,</span> <span class="n">num_cands</span><span class="p">)</span>

<span class="n">prf</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prf</span><span class="o">.</span><span class="n">support</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prf</span><span class="o">.</span><span class="n">support</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prf</span><span class="o">.</span><span class="n">support</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prf.margin(0,1)&quot;</span><span class="p">,</span> <span class="n">prf</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prf.margin(1,0)&quot;</span><span class="p">,</span> <span class="n">prf</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prf.margin(0,2)&quot;</span><span class="p">,</span> <span class="n">prf</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prf.margin(2,0)&quot;</span><span class="p">,</span> <span class="n">prf</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prf.margin(1,2)&quot;</span><span class="p">,</span> <span class="n">prf</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;prf.margin(2,1)&quot;</span><span class="p">,</span> <span class="n">prf</span><span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">prf</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">())</span>

<span class="n">prf</span><span class="o">.</span><span class="n">display_margin_graph</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---+-----+-------+-----+
| 1 |  1  |   1   |  1  |
+---+-----+-------+-----+
| 3 |  0  | 0,1,2 |  2  |
| 0 |  3  |       |  3  |
| 1 | 1,2 |       | 0,1 |
| 2 |     |       |     |
+---+-----+-------+-----+
2.0
2.0
1.0
prf.margin(0,1) 2.0
prf.margin(1,0) -2.0
prf.margin(0,2) 1.0
prf.margin(2,0) -1.0
prf.margin(1,2) 0.0
prf.margin(2,1) 0.0
None
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">21</span><span class="o">-</span><span class="mi">793</span><span class="n">b3c45aa01</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">    </span><span class="mi">161</span> <span class="nb">print</span><span class="p">(</span><span class="n">prf</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">162</span> 
<span class="ne">--&gt; </span><span class="mi">163</span> <span class="n">prf</span><span class="o">.</span><span class="n">display_margin_graph</span><span class="p">()</span>

<span class="nn">&lt;ipython-input-21-793b3c45aa01&gt;</span> in <span class="ni">display_margin_graph</span><span class="nt">(self, cmap)</span>
<span class="g g-Whitespace">    </span><span class="mi">135</span> 
<span class="g g-Whitespace">    </span><span class="mi">136</span>         <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">mg</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">137</span>         <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> 
<span class="g g-Whitespace">    </span><span class="mi">138</span>                 <span class="n">font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">139</span>                 <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.9/site-packages/networkx/drawing/nx_pylab.py</span> in <span class="ni">draw</span><span class="nt">(G, pos, ax, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">121</span>         <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;with_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;labels&quot;</span> <span class="ow">in</span> <span class="n">kwds</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span> 
<span class="ne">--&gt; </span><span class="mi">123</span>     <span class="n">draw_networkx</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span>     <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="n">plt</span><span class="o">.</span><span class="n">draw_if_interactive</span><span class="p">()</span>

<span class="nn">/usr/local/lib/python3.9/site-packages/networkx/drawing/nx_pylab.py</span> in <span class="ni">draw_networkx</span><span class="nt">(G, pos, arrows, with_labels, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">324</span>     <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_kwds</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">]):</span>
<span class="g g-Whitespace">    </span><span class="mi">325</span>         <span class="n">invalid_args</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_kwds</span><span class="p">])</span>
<span class="ne">--&gt; </span><span class="mi">326</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid argument(s): </span><span class="si">{</span><span class="n">invalid_args</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span> 
<span class="g g-Whitespace">    </span><span class="mi">328</span>     <span class="n">node_kwds</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwds</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">valid_node_kwds</span><span class="p">}</span>

<span class="ne">ValueError</span>: Received invalid argument(s): lw
</pre></div>
</div>
<img alt="../_images/polls-deliberation_26_2.png" src="../_images/polls-deliberation_26_2.png" />
</div>
</div>
</div>
<div class="section" id="polling-information">
<h2>Polling Information<a class="headerlink" href="#polling-information" title="Permalink to this headline">¶</a></h2>
<p>Annemieke Reijngoud and Ulle Endriss. <a class="reference external" href="https://staff.fnwi.uva.nl/u.endriss/pubs/files/ReijngoudEndrissAAMAS2012.pdf">Voter Response to Iterated Poll Information</a>. In Proceedings of the 11th International Conference on Autonomous Agents and Multiagent Systems (AAMAS-2012), June 2012.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Voter</span><span class="p">():</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ranking</span> <span class="o">=</span> <span class="n">ranking</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="n">bias</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span>
        
    <span class="k">def</span> <span class="nf">update_poll_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top_winners</span><span class="p">):</span>
        
        <span class="sd">&#39;&#39;&#39;choose favorite candidate from top_winners and move that candidate to the top of the ranking&#39;&#39;&#39;</span>
        
        <span class="n">winner</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ranking</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">top_winners</span><span class="p">}</span>
        
        <span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">winner</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">cr</span><span class="p">:</span> <span class="n">cr</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        
    
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;0,1,2,3&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
<span class="n">v</span><span class="o">.</span><span class="n">update_poll_information</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0,1,2,3
1,0,2,3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_cands</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">num_voters</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">all_profiles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_profiles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">:</span> 
    
    <span class="n">prof</span> <span class="o">=</span> <span class="n">generate_profile</span><span class="p">(</span><span class="n">num_cands</span><span class="p">,</span> <span class="n">num_voters</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">all_profiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_cands</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">num_voters</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">num_winners_poll</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">cond_eff</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;before_poll&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;after_poll&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="n">max_rounds</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>

<span class="k">for</span> <span class="n">prof</span> <span class="ow">in</span> <span class="n">all_profiles</span><span class="p">:</span> 
    <span class="n">voters</span> <span class="o">=</span> <span class="p">[</span><span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">r</span><span class="p">))),</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span>  <span class="n">prof</span><span class="o">.</span><span class="n">rankings</span><span class="p">]</span>
    <span class="n">cw</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;before_poll&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plurality</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">cw</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_rounds</span><span class="p">):</span> 
        
        <span class="n">did_voters_change</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">:</span> 
            <span class="n">init_ranking</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
            <span class="n">plurality_scores</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">plurality_scores</span><span class="p">()</span>

            <span class="n">top_winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">plurality_scores</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">cp</span><span class="p">:</span> <span class="n">cp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">num_winners_poll</span><span class="p">]]</span>
            <span class="n">v</span><span class="o">.</span><span class="n">update_poll_information</span><span class="p">(</span><span class="n">top_winners</span><span class="p">)</span>

            <span class="n">did_voters_change</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init_ranking</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">))</span>
            <span class="n">prof</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">_v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">],</span> <span class="n">num_cands</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">did_voters_change</span><span class="p">):</span>
            <span class="k">break</span>
    <span class="n">cw</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;after_poll&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plurality</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">cw</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plurality&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Poll&quot;</span><span class="p">,</span> <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;before_poll&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_profiles</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Poll 2-pragmatist&quot;</span><span class="p">,</span> <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;after_poll&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_profiles</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plurality
No Poll 0.5943
Poll 2-pragmatist 0.9758
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_cands</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">num_voters</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">cond_eff</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;before_poll&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;after_poll&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="n">max_rounds</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">num_winners_poll</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>

<span class="k">for</span> <span class="n">prof</span> <span class="ow">in</span> <span class="n">all_profiles</span><span class="p">:</span> 
    <span class="n">voters</span> <span class="o">=</span> <span class="p">[</span><span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">r</span><span class="p">))),</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span>  <span class="n">prof</span><span class="o">.</span><span class="n">rankings</span><span class="p">]</span>
    <span class="n">cw</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;before_poll&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plurality</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">cw</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_rounds</span><span class="p">):</span> 
        
        <span class="n">did_voters_change</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">:</span> 
            <span class="n">init_ranking</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
            <span class="n">plurality_scores</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">plurality_scores</span><span class="p">()</span>

            <span class="n">top_winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">plurality_scores</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">cp</span><span class="p">:</span> <span class="n">cp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">num_winners_poll</span><span class="p">]]</span>
            <span class="n">v</span><span class="o">.</span><span class="n">update_poll_information</span><span class="p">(</span><span class="n">top_winners</span><span class="p">)</span>

            <span class="n">did_voters_change</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init_ranking</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">))</span>
            <span class="n">prof</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">_v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">],</span> <span class="n">num_cands</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">did_voters_change</span><span class="p">):</span>
            <span class="k">break</span>
    <span class="n">cw</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;after_poll&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plurality</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">cw</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Plurality&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Poll&quot;</span><span class="p">,</span> <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;before_poll&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_profiles</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Poll 3-pragmatist&quot;</span><span class="p">,</span> <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;after_poll&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_profiles</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plurality
No Poll 0.5943
Poll 3-pragmatist 0.7419
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_cands</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">num_voters</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">num_winners_poll</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">cond_eff</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;before_poll&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;after_poll&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="n">max_rounds</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>

<span class="k">for</span> <span class="n">prof</span> <span class="ow">in</span> <span class="n">all_profiles</span><span class="p">:</span> 
    <span class="n">voters</span> <span class="o">=</span> <span class="p">[</span><span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">r</span><span class="p">))),</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span>  <span class="n">prof</span><span class="o">.</span><span class="n">rankings</span><span class="p">]</span>
    <span class="n">cw</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;before_poll&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">borda</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">cw</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_rounds</span><span class="p">):</span> 
        
        <span class="n">did_voters_change</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">:</span> 
            <span class="n">init_ranking</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
            <span class="n">borda_scores</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">borda_scores</span><span class="p">()</span>

            <span class="n">top_winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                                                  <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">cp</span><span class="p">:</span> <span class="n">cp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                                  <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">num_winners_poll</span><span class="p">]]</span>
            <span class="n">v</span><span class="o">.</span><span class="n">update_poll_information</span><span class="p">(</span><span class="n">top_winners</span><span class="p">)</span>

            <span class="n">did_voters_change</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init_ranking</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">))</span>
            <span class="n">prof</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">_v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">],</span> <span class="n">num_cands</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">did_voters_change</span><span class="p">):</span>
            <span class="k">break</span>
    <span class="n">cw</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;after_poll&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">borda</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">cw</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Borda&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Poll&quot;</span><span class="p">,</span> <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;before_poll&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_profiles</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Poll 2-pragmatist&quot;</span><span class="p">,</span> <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;after_poll&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_profiles</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Borda
No Poll 0.9081
Poll 2-pragmatist 0.9159
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_cands</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">num_voters</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">num_winners_poll</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">cond_eff</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;before_poll&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;after_poll&quot;</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="n">max_rounds</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>

<span class="k">for</span> <span class="n">prof</span> <span class="ow">in</span> <span class="n">all_profiles</span><span class="p">:</span> 
    <span class="n">voters</span> <span class="o">=</span> <span class="p">[</span><span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">r</span><span class="p">))),</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span>  <span class="n">prof</span><span class="o">.</span><span class="n">rankings</span><span class="p">]</span>
    <span class="n">cw</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;before_poll&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">borda</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">cw</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_rounds</span><span class="p">):</span> 
        
        <span class="n">did_voters_change</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">:</span> 
            <span class="n">init_ranking</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
            <span class="n">borda_scores</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">borda_scores</span><span class="p">()</span>

            <span class="n">top_winners</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">borda_scores</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> 
                                                  <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">cp</span><span class="p">:</span> <span class="n">cp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                                  <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="n">num_winners_poll</span><span class="p">]]</span>
            <span class="n">v</span><span class="o">.</span><span class="n">update_poll_information</span><span class="p">(</span><span class="n">top_winners</span><span class="p">)</span>

            <span class="n">did_voters_change</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">init_ranking</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">))</span>
            <span class="n">prof</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">([</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">_v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">_v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">],</span> <span class="n">num_cands</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">did_voters_change</span><span class="p">):</span>
            <span class="k">break</span>
    <span class="n">cw</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;after_poll&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">borda</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="n">cw</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Borda&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Poll&quot;</span><span class="p">,</span> <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;before_poll&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_profiles</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Poll 3-pragmatist&quot;</span><span class="p">,</span> <span class="n">cond_eff</span><span class="p">[</span><span class="s2">&quot;after_poll&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_profiles</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Borda
No Poll 0.9081
Poll 3-pragmatist 0.9072
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="modeling-deliberation">
<h2>Modeling Deliberation<a class="headerlink" href="#modeling-deliberation" title="Permalink to this headline">¶</a></h2>
<p>Soroush Rafiee Rad and Olivier Roy (2021).<a class="reference external" href="https://www.cambridge.org/core/journals/american-political-science-review/article/abs/deliberation-singlepeakedness-and-coherent-aggregation/652CCF8DF5B03EF352B4B04AD66D90C0">Deliberation, Single-Peakedness, and Coherent Aggregation</a>, American Political Science Review, 115, 2, pp. 629 - 648.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Voter</span><span class="p">():</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">bias</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ranking</span> <span class="o">=</span> <span class="n">ranking</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">=</span> <span class="n">bias</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span>
        
    <span class="k">def</span> <span class="nf">update_poll_information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">top_winners</span><span class="p">):</span>
        
        <span class="sd">&#39;&#39;&#39;choose favorite candidate from top_winners and move that candidate to the top of the ranking&#39;&#39;&#39;</span>
        
        <span class="n">winner</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">ranking</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">top_winners</span><span class="p">}</span>
        
        <span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="o">.</span><span class="n">lift</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">winner</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">cr</span><span class="p">:</span> <span class="n">cr</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">update_deliberation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other_ranking</span><span class="p">,</span> <span class="n">only_linear</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        
        <span class="sd">&#39;&#39;&#39;choose favorite candidate from top_winners and move that candidate to the top of the ranking&#39;&#39;&#39;</span>
        <span class="n">min_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">new_rankings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        
        <span class="n">possible_orderings</span> <span class="o">=</span> <span class="n">weak_orders</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ranking</span><span class="o">.</span><span class="n">num_alts</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">only_linear</span> <span class="k">else</span> <span class="n">lin_orders</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ranking</span><span class="o">.</span><span class="n">num_alts</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">wr</span> <span class="ow">in</span> <span class="n">possible_orderings</span><span class="p">:</span>
            
            <span class="n">dist</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranking</span><span class="p">,</span> <span class="n">wr</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bias</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">other_ranking</span><span class="p">,</span> <span class="n">wr</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">dist</span> <span class="o">&lt;</span> <span class="n">min_dist</span><span class="p">:</span> 
                <span class="n">min_dist</span> <span class="o">=</span> <span class="n">dist</span>
                <span class="n">new_rankings</span> <span class="o">=</span> <span class="p">[</span><span class="n">wr</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">dist</span> <span class="o">==</span> <span class="n">min_dist</span><span class="p">:</span>
                <span class="n">new_rankings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wr</span><span class="p">)</span>
        <span class="c1">#print([str(r) for r in new_rankings])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ranking</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">new_rankings</span><span class="p">)</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;0,{1,2},3&quot;</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ks_dist</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
<span class="n">v</span><span class="o">.</span><span class="n">update_deliberation</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;2,1,3,0&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0,{1,2},3
{1,2},0,3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;0,1,2,3&quot;</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ks_dist</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
<span class="n">v</span><span class="o">.</span><span class="n">update_deliberation</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;1,0,2,3&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-----</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;0,1,2,3&quot;</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">ks_dist</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
<span class="n">v</span><span class="o">.</span><span class="n">update_deliberation</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span><span class="o">=</span><span class="s2">&quot;1,0,2,3&quot;</span><span class="p">),</span> <span class="n">only_linear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0,1,2,3
{0,1},2,3

-----

0,1,2,3
1,0,2,3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_rounds</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">num_voters</span> <span class="o">=</span> <span class="mi">11</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">bias</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">dp_dist</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>

<span class="n">lin_prof</span> <span class="o">=</span> <span class="n">generate_profile</span><span class="p">(</span><span class="n">num_cands</span><span class="p">,</span> <span class="n">num_voters</span><span class="p">,</span> <span class="n">probmod</span><span class="o">=</span><span class="s2">&quot;SinglePeaked&quot;</span><span class="p">)</span>

<span class="n">voters</span> <span class="o">=</span> <span class="p">[</span><span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">r</span><span class="p">))),</span> <span class="n">bias</span><span class="p">,</span> <span class="n">dp_dist</span><span class="p">)</span> 
          <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">lin_prof</span><span class="o">.</span><span class="n">rankings</span><span class="p">]</span>


<span class="n">prof</span> <span class="o">=</span> <span class="n">wProfile</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">],</span> <span class="n">num_cands</span><span class="p">)</span>

<span class="n">prof</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="n">prof</span><span class="o">.</span><span class="n">display_margin_graph</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">())</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rounds</span><span class="p">):</span> 
    
    <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">:</span> 
        
        <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">:</span> 
            <span class="c1">#print(v2.ranking)</span>
            <span class="k">if</span> <span class="n">v1</span> <span class="o">!=</span> <span class="n">v2</span><span class="p">:</span> 
                <span class="c1">#print(&quot;change&quot;)</span>
                <span class="n">v2</span><span class="o">.</span><span class="n">update_deliberation</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">ranking</span><span class="p">,</span> <span class="n">only_linear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1">#print(v2.ranking)</span>
                
        <span class="n">prof</span> <span class="o">=</span> <span class="n">wProfile</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">],</span> <span class="n">num_cands</span><span class="p">)</span>
        <span class="n">prof</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">())</span>
<span class="n">prof</span><span class="o">.</span><span class="n">display_margin_graph</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+---+---+---+---+---+---+---+---+---+---+---+
| 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 |
+---+---+---+---+---+---+---+---+---+---+---+
| 1 | 1 | 1 | 2 | 2 | 2 | 2 | 3 | 2 | 2 | 1 |
| 2 | 2 | 2 | 1 | 3 | 3 | 3 | 2 | 1 | 1 | 0 |
| 3 | 3 | 3 | 0 | 1 | 1 | 1 | 1 | 3 | 3 | 2 |
| 0 | 0 | 0 | 3 | 0 | 0 | 0 | 0 | 0 | 0 | 3 |
+---+---+---+---+---+---+---+---+---+---+---+
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">30</span><span class="o">-</span><span class="mi">1</span><span class="n">eea2becace1</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> 
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="n">prof</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">20</span> <span class="n">prof</span><span class="o">.</span><span class="n">display_margin_graph</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> 
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="nb">print</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">())</span>

<span class="nn">&lt;ipython-input-21-793b3c45aa01&gt;</span> in <span class="ni">display_margin_graph</span><span class="nt">(self, cmap)</span>
<span class="g g-Whitespace">    </span><span class="mi">135</span> 
<span class="g g-Whitespace">    </span><span class="mi">136</span>         <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">circular_layout</span><span class="p">(</span><span class="n">mg</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">137</span>         <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> 
<span class="g g-Whitespace">    </span><span class="mi">138</span>                 <span class="n">font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">font_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">node_size</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">139</span>                 <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">/usr/local/lib/python3.9/site-packages/networkx/drawing/nx_pylab.py</span> in <span class="ni">draw</span><span class="nt">(G, pos, ax, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">121</span>         <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;with_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;labels&quot;</span> <span class="ow">in</span> <span class="n">kwds</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span> 
<span class="ne">--&gt; </span><span class="mi">123</span>     <span class="n">draw_networkx</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span>     <span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>     <span class="n">plt</span><span class="o">.</span><span class="n">draw_if_interactive</span><span class="p">()</span>

<span class="nn">/usr/local/lib/python3.9/site-packages/networkx/drawing/nx_pylab.py</span> in <span class="ni">draw_networkx</span><span class="nt">(G, pos, arrows, with_labels, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">324</span>     <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_kwds</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">]):</span>
<span class="g g-Whitespace">    </span><span class="mi">325</span>         <span class="n">invalid_args</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwds</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_kwds</span><span class="p">])</span>
<span class="ne">--&gt; </span><span class="mi">326</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid argument(s): </span><span class="si">{</span><span class="n">invalid_args</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span> 
<span class="g g-Whitespace">    </span><span class="mi">328</span>     <span class="n">node_kwds</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwds</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">valid_node_kwds</span><span class="p">}</span>

<span class="ne">ValueError</span>: Received invalid argument(s): lw
</pre></div>
</div>
<img alt="../_images/polls-deliberation_37_2.png" src="../_images/polls-deliberation_37_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">has_cycle</span><span class="p">(</span><span class="n">mg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;true if the margin graph mg has a cycle&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cycles</span> <span class="o">=</span>  <span class="n">nx</span><span class="o">.</span><span class="n">find_cycle</span><span class="p">(</span><span class="n">mg</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">cycles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">cycles</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_trials</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">num_voters</span> <span class="o">=</span> <span class="mi">21</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">num_rounds</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">probmod</span> <span class="o">=</span> <span class="s2">&quot;IC&quot;</span>
<span class="n">bias</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">dp_dist</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>

<span class="n">cond_winner</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;before_delib&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;after_delib&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;diff_cond_winner&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">cycles</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;before_delib&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;after_delib&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">)):</span> 
    <span class="n">lin_prof</span> <span class="o">=</span> <span class="n">generate_profile</span><span class="p">(</span><span class="n">num_cands</span><span class="p">,</span> <span class="n">num_voters</span><span class="p">,</span> <span class="n">probmod</span><span class="o">=</span><span class="n">probmod</span><span class="p">)</span>
    

    <span class="n">voters</span> <span class="o">=</span> <span class="p">[</span><span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">r</span><span class="p">))),</span> <span class="n">bias</span><span class="p">,</span> <span class="n">dp_dist</span><span class="p">)</span> 
              <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">lin_prof</span><span class="o">.</span><span class="n">rankings</span><span class="p">]</span>


    <span class="n">prof</span> <span class="o">=</span> <span class="n">wProfile</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">],</span> <span class="n">num_cands</span><span class="p">)</span>
    
    <span class="n">cw</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    
    <span class="n">cycles</span><span class="p">[</span><span class="s2">&quot;before_delib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">has_cycle</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">margin_graph</span><span class="p">()))</span>
    
    <span class="n">cond_winner</span><span class="p">[</span><span class="s2">&quot;before_delib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    
    <span class="c1"># now, deliberate</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rounds</span><span class="p">):</span> 

        <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">:</span> 

            <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">:</span> 
                <span class="c1">#print(v2.ranking)</span>
                <span class="k">if</span> <span class="n">v1</span> <span class="o">!=</span> <span class="n">v2</span><span class="p">:</span> 
                    <span class="c1">#print(&quot;change&quot;)</span>
                    <span class="n">v2</span><span class="o">.</span><span class="n">update_deliberation</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">ranking</span><span class="p">,</span> <span class="n">only_linear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="c1">#print(v2.ranking)</span>
                    
    <span class="n">prof2</span> <span class="o">=</span> <span class="n">wProfile</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">],</span> <span class="n">num_cands</span><span class="p">)</span>
    
    <span class="n">cw_after</span> <span class="o">=</span> <span class="n">prof2</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    
    <span class="n">cycles</span><span class="p">[</span><span class="s2">&quot;after_delib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">has_cycle</span><span class="p">(</span><span class="n">prof2</span><span class="o">.</span><span class="n">margin_graph</span><span class="p">()))</span>
    
    <span class="n">cond_winner</span><span class="p">[</span><span class="s2">&quot;after_delib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw_after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">cond_winner</span><span class="p">[</span><span class="s2">&quot;diff_cond_winner&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cw</span> <span class="o">!=</span> <span class="n">cw_after</span>
            
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prob profiles with cycles before deliberation: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cycles</span><span class="p">[</span><span class="s1">&#39;before_delib&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_trials</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prob profiles with cycles after deliberation: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cycles</span><span class="p">[</span><span class="s1">&#39;after_delib&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_trials</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prob profiles with Condorcet winner before deliberation: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cond_winner</span><span class="p">[</span><span class="s1">&#39;before_delib&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_trials</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prob profiles with Condorcet winner after deliberation: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cond_winner</span><span class="p">[</span><span class="s1">&#39;after_delib&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_trials</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prob profiles with different Condorcet winner after deliberation: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cond_winner</span><span class="p">[</span><span class="s1">&#39;diff_cond_winner&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_trials</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "98a5559b11874c48af17f5267c31c09f", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prob profiles with cycles before deliberation: 0.087
Prob profiles with cycles after deliberation: 0.0


Prob profiles with Condorcet winner before deliberation: 0.913
Prob profiles with Condorcet winner after deliberation: 0.931
Prob profiles with different Condorcet winner after deliberation: 0.501
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_trials</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">num_voters</span> <span class="o">=</span> <span class="mi">21</span>

<span class="n">num_cands</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">num_rounds</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">probmod</span> <span class="o">=</span> <span class="s2">&quot;SinglePeaked&quot;</span>
<span class="n">bias</span> <span class="o">=</span> <span class="mf">0.8</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">ks_dist</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_cands</span><span class="p">)}</span>

<span class="n">cond_winner</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;before_delib&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;after_delib&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;diff_cond_winner&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="n">cycles</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;before_delib&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;after_delib&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_trials</span><span class="p">)):</span> 
    <span class="n">lin_prof</span> <span class="o">=</span> <span class="n">generate_profile</span><span class="p">(</span><span class="n">num_cands</span><span class="p">,</span> <span class="n">num_voters</span><span class="p">,</span> <span class="n">probmod</span><span class="o">=</span><span class="n">probmod</span><span class="p">)</span>
    

    <span class="n">voters</span> <span class="o">=</span> <span class="p">[</span><span class="n">Voter</span><span class="p">(</span><span class="n">wRanking</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="n">r_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">r</span><span class="p">))),</span> <span class="n">bias</span><span class="p">,</span> <span class="n">dp_dist</span><span class="p">)</span> 
              <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">lin_prof</span><span class="o">.</span><span class="n">rankings</span><span class="p">]</span>


    <span class="n">prof</span> <span class="o">=</span> <span class="n">wProfile</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">],</span> <span class="n">num_cands</span><span class="p">)</span>
    
    <span class="n">cw</span> <span class="o">=</span> <span class="n">prof</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    
    <span class="n">cycles</span><span class="p">[</span><span class="s2">&quot;before_delib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">has_cycle</span><span class="p">(</span><span class="n">prof</span><span class="o">.</span><span class="n">margin_graph</span><span class="p">()))</span>
    
    <span class="n">cond_winner</span><span class="p">[</span><span class="s2">&quot;before_delib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    
    <span class="c1"># now, deliberate</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rounds</span><span class="p">):</span> 

        <span class="k">for</span> <span class="n">v1</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">:</span> 

            <span class="k">for</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">:</span> 
                <span class="c1">#print(v2.ranking)</span>
                <span class="k">if</span> <span class="n">v1</span> <span class="o">!=</span> <span class="n">v2</span><span class="p">:</span> 
                    <span class="c1">#print(&quot;change&quot;)</span>
                    <span class="n">v2</span><span class="o">.</span><span class="n">update_deliberation</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">ranking</span><span class="p">,</span> <span class="n">only_linear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="c1">#print(v2.ranking)</span>
                    
    <span class="n">prof2</span> <span class="o">=</span> <span class="n">wProfile</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">ranking</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">voters</span><span class="p">],</span> <span class="n">num_cands</span><span class="p">)</span>
    
    <span class="n">cw_after</span> <span class="o">=</span> <span class="n">prof2</span><span class="o">.</span><span class="n">condorcet_winner</span><span class="p">()</span>
    
    <span class="n">cycles</span><span class="p">[</span><span class="s2">&quot;after_delib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">has_cycle</span><span class="p">(</span><span class="n">prof2</span><span class="o">.</span><span class="n">margin_graph</span><span class="p">()))</span>
    
    <span class="n">cond_winner</span><span class="p">[</span><span class="s2">&quot;after_delib&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cw_after</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">cond_winner</span><span class="p">[</span><span class="s2">&quot;diff_cond_winner&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cw</span> <span class="o">!=</span> <span class="n">cw_after</span>
            
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prob profiles with cycles before deliberation: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cycles</span><span class="p">[</span><span class="s1">&#39;before_delib&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_trials</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prob profiles with cycles after deliberation: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cycles</span><span class="p">[</span><span class="s1">&#39;after_delib&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_trials</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prob profiles with Condorcet winner before deliberation: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cond_winner</span><span class="p">[</span><span class="s1">&#39;before_delib&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_trials</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prob profiles with Condorcet winner after deliberation: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cond_winner</span><span class="p">[</span><span class="s1">&#39;after_delib&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_trials</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prob profiles with different Condorcet winner after deliberation: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">cond_winner</span><span class="p">[</span><span class="s1">&#39;diff_cond_winner&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">num_trials</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "bbd4a6c7002a4ce6b27cc298572d61ce", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prob profiles with cycles before deliberation: 0.0
Prob profiles with cycles after deliberation: 0.0


Prob profiles with Condorcet winner before deliberation: 1.0
Prob profiles with Condorcet winner after deliberation: 0.933
Prob profiles with different Condorcet winner after deliberation: 0.441
</pre></div>
</div>
</div>
</div>
</div>
</div>


<script type="application/vnd.jupyter.widget-state+json">
{"state": {"06b8e37b3a954b0daf3aea6226209f38": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "0e02a0f41b8f47ca9765d942a95bb1ae": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "36366a78e7ae48dd96b124c71f90dfdf": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "3bf4f4a675264d3cafa3123e86f062d0": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ProgressStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "404185f11a6e4dc49f45098fe402c8a0": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "5d35b944982e4580b44959aa6d8281fd": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "ProgressStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "9474f7df725d485f8ac928d25aaca9ed": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "971467a6f041429c9cae92130fc6346a": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_e43978b818054ba48b89e12e4b8ff09c", "placeholder": "\u200b", "style": "IPY_MODEL_9474f7df725d485f8ac928d25aaca9ed", "value": " 1000/1000 [19:41&lt;00:00,  3.69s/it]"}}, "98a5559b11874c48af17f5267c31c09f": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HBoxModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_a3d38318c22e4eecb973c98ecc307071", "IPY_MODEL_ce3025effea74994927d7955fa836398", "IPY_MODEL_a7988206056145689c100be1f1b28683"], "layout": "IPY_MODEL_e141e168eed24fdea689f99f82de7d7f"}}, "998f824c8a76402091566735114b97d9": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "a0e74c24731f47868f7299cd7ff5589d": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "a3d38318c22e4eecb973c98ecc307071": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_ae4285e861c34ff394c580d6c7e8d80c", "placeholder": "\u200b", "style": "IPY_MODEL_ab50f02dad3649209a3a7907ca16c035", "value": "100%"}}, "a7988206056145689c100be1f1b28683": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_ef2a485612c54f0ca1831d79e8607179", "placeholder": "\u200b", "style": "IPY_MODEL_36366a78e7ae48dd96b124c71f90dfdf", "value": " 1000/1000 [01:25&lt;00:00, 11.10it/s]"}}, "a8e1da1c70a2405da16cee7e7f47571f": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HTMLModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HTMLView", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_a0e74c24731f47868f7299cd7ff5589d", "placeholder": "\u200b", "style": "IPY_MODEL_0e02a0f41b8f47ca9765d942a95bb1ae", "value": "100%"}}, "ab50f02dad3649209a3a7907ca16c035": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "DescriptionStyleModel", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "DescriptionStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "StyleView", "description_width": ""}}, "ae4285e861c34ff394c580d6c7e8d80c": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "bbd4a6c7002a4ce6b27cc298572d61ce": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "HBoxModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_a8e1da1c70a2405da16cee7e7f47571f", "IPY_MODEL_c2a33927e8cb4c7a9cc38a91ede57768", "IPY_MODEL_971467a6f041429c9cae92130fc6346a"], "layout": "IPY_MODEL_06b8e37b3a954b0daf3aea6226209f38"}}, "c2a33927e8cb4c7a9cc38a91ede57768": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "FloatProgressModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_998f824c8a76402091566735114b97d9", "max": 1000.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_3bf4f4a675264d3cafa3123e86f062d0", "value": 1000.0}}, "ce3025effea74994927d7955fa836398": {"model_module": "@jupyter-widgets/controls", "model_module_version": "1.5.0", "model_name": "FloatProgressModel", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "1.5.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "1.5.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_tooltip": null, "layout": "IPY_MODEL_404185f11a6e4dc49f45098fe402c8a0", "max": 1000.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_5d35b944982e4580b44959aa6d8281fd", "value": 1000.0}}, "e141e168eed24fdea689f99f82de7d7f": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "e43978b818054ba48b89e12e4b8ff09c": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "ef2a485612c54f0ca1831d79e8607179": {"model_module": "@jupyter-widgets/base", "model_module_version": "1.2.0", "model_name": "LayoutModel", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "1.2.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "1.2.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "overflow_x": null, "overflow_y": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}}, "version_major": 2, "version_minor": 0}
</script>


    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./preference-aggregation"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="probmodels.html" title="previous page">Probability Models</a>
    <a class='right-next' id="next-link" href="grading-jury-theorem.html" title="next page">Grading Jury Theorem</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Eric Pacuit<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>